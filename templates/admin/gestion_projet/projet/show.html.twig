{% extends 'admin/base.html.twig' %}

{% import "macros/table.html.twig" as table %}
{% import "macros/head.html.twig" as head %}
{% import "macros/foot.html.twig" as foot %}
{% import "macros/breadcrumb.html.twig" as utils %}
{% import "macros/alertes.html.twig" as alerte %}
{% import "macros/button.html.twig" as btn %}
{% import "macros/link.html.twig" as link %}
{% import "macros/badge.html.twig" as badge %}
{% import "macros/dataTable.html.twig" as dataTable %}

{% block head %}
	{{ dataTable.css() }}
{% endblock %}

{% block foot %}
	{{ dataTable.js() }}
{% endblock %}

{% block javascripts %}
	{{ dataTable.script('#table-1') }}
	{{ dataTable.script('#table-2') }}
	{{ dataTable.script('#table-3') }}
{% endblock %}

{% block title %}
	Projet Visualisation
{% endblock %}

{% block body %}
	{% for item in app.flashes('success') %}
		{{alerte.alert(item,'success')}}
	{% endfor %}
	<div class="row mb-3">
		<div class="col-lg-12 cold-md-12 col-xm-12">
			<div class="card card-outline card-dark">
				<div class="card-header">Information sur le projet</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 bol font-weight-bold">Designation</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{projet.designation}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 bol font-weight-bold">Description</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{projet.description}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 bol font-weight-bold">Projet De Type</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{projet.type}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 bol font-weight-bold">Estimé à la valeur</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{projet.valeurTotal|number_format(0, '', ' ')}}</p>
								</div>
							</div>
							<hr>
						</div>
						<div class="col-md-6">
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 bol font-weight-bold">Etat du projet</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{projet.etat}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Débuter le
									</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{projet.dateDebut ? projet.dateDebut|date_format_fr('Y-m-d') : ''}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 bol font-weight-bold">Date de fin prévu</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{projet.dateDebut ? projet.dateDebut|date_format_fr('Y-m-d') : ''}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 bol font-weight-bold">Date de Fin Exacte</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{projet.dateFinRealisation ? projet.dateFinRealisation|date_format_fr('Y-m-d') : 'non definie'}}</p>
								</div>
							</div>
							<hr>
						</div>
					</div>
				</div>
				<div class="card-footer">
					{{link.back(path('projet_index'),'Liste des Projets')}}
					{{link.edit(path('projet_edit', {'id': projet.id}))}}

				</div>
			</div>
		</div>
	</div>

	<div class="row mb-3">
		<div class="col-lg-12 cold-md-12 col-xm-12">
			<div class="card card-outline card-dark">
				<div class="card-header">Information du Client</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Nom Complet</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.getFullName}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Nom</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.personneGestion.nom}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Prenom</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.personneGestion.prenom}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Adresse</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.personneGestion.adresse}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Téléphone</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.personneGestion.phone}}</p>
								</div>
							</div>
							<hr>
						</div>
						<div class="col-md-6">
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Titre</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.personneGestion.titre}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Email</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.personneGestion.email}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Ville</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.ville}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">Pays</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.pays}}</p>
								</div>
							</div>
							<hr>
							<div class="row">
								<div class="col-sm-3">
									<p class="mb-0 font-weight-bold">A T'il un profile ?</p>
								</div>
								<div class="col-sm-9">
									<p class="text-muted mb-0">{{client.personneGestion.avatar ? 'la gestion des images se fera après' : 'pas de profil'}}</p>
								</div>
							</div>
							<hr>
						</div>
					</div>
				</div>
				<div class="card-footer">
					{{link.back(path('projet_index'),'Liste des Projets')}}
					{{link.edit(path('client_edit', {'id': projet.client.id}))}}

				</div>
			</div>
		</div>
	</div>

	<div class="row mb-3">
		<div class="col-lg-12 cold-md-12 col-xm-12">
			<div class="card card-outline card-dark">
				<div class="card-header">Information sur le paiment du  projet</div>
				<div class="card-body">

					<div class="row">
						<div class="col-md-7">
							<p>
								Le cout total du projet est :
								<b class="text-danger">{{paiement.montantTotal|number_format(0, '', ' ')}}
								</b>&nbsp; fcfa,
								{% if paiement.montantDu > 0 %}
									le paiement n'est pas ecore achevé, il reste la somme de
									<b class="text-danger">{{paiement.montantDu|number_format(0, '', ' ')}}
									</b>&nbsp; fcfa
								{% elseif paiement.montantDu == 0 %}
									le paiement est  achevé, il reste la somme de
									<b class="text-danger">{{paiement.montantDu|number_format(0, '', ' ')}}
									</b>&nbsp; fcfa
								{% endif %}
							</p>
						</div>
						<div class="col-md-5 text-right">
							<p>
								Mr ou Mme
								<b class="text-success">{{projet.client.getFullName}}</b>
								&nbsp;a effectué
								<b class="text-danger">{{avance_paiements|length}}</b>&nbsp; avance (s)
							</p>
						</div>
					</div>
					<h3 class="text-center mt-3 mb-3">Liste Avance(s) reçu(es)</h3>
					<div class="row">
						<div class="col-lg-12 col-md-12 col-xm-12">
							<table class="table" id="table-2">
								<thead>
									<tr>
										<th>Avance reçcu le</th>
										<th>Montant Avance</th>
										<th>Montant Restant</th>
										<th>Est Atteint</th>
										<th>Mode Paiement</th>
									</tr>
								</thead>
								<tbody>
									{% for avance_paiement in avance_paiements %}
										<tr>
											<td>{{ avance_paiement.dateAvance ? avance_paiement.dateAvance|date_format_fr('Y-m-d') : '' }}</td>
											<td>{{ avance_paiement.montantAvance|number_format(0, '', ' ') }}</td>
											<td>{{ avance_paiement.montantDu|number_format(0, '', ' ') }}</td>
											<td>
												{% if avance_paiement.estAtteint %}
													{{badge.complet('Yes')}}
												{% else %}
													{{ badge.annuler('No')}}
												{% endif %}

											</td>
											<td>{{ avance_paiement.modePaiementAvance }}</td>

										</tr>
									{% else %}
										<tr>
											<td colspan="8">no records found</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
				<div class="card-footer">
					{{link.back(path('projet_index'),'Liste des Projets')}}
					{{link.manageList(path('avance_paiement_index', {'id': projet.id}),'gerer les avances')}}
				</div>
			</div>
		</div>
	</div>

	<div class="row mb-3">
		<div class="col-lg-12 cold-md-12 col-xm-12">
			<div class="card card-outline card-dark">
				<div class="card-header">Les Collaborateurs du  projet</div>
				<div class="card-body">
					<p>
						Il y a
						<b class="text-danger">{{collaborateurs|length}}</b>&nbsp; collaborateur(s) qui travail (lent) avec vous sur le projet de :
						<b class="text-danger">{{projet.designation}}
						</b>&nbsp;
					</p>
					<div class="row">
						<div class="col-md-12 col-lg-12 col_xm-12">
							<table class="table" id="table-2">
								<thead>
									<tr>
										<th>Nom & Prenom</th>
										<th>Apport</th>
										<th>NiveauExcellence</th>
										<th>Tache Réalisées</th>
										<th>actions</th>
									</tr>
								</thead>
								<tbody>
									{% for collaborateur in collaborateurs %}
										<tr>
											<td>{{ collaborateur.getFullName }}</td>
											<td>{{ collaborateur.apport }}</td>
											<td>{{ collaborateur.niveauExcellence }}</td>
											<td>
												{% if collaborateur.tache|length >= 1 %}
													{% for tache in collaborateur.tache %}
														{{tache.designation}}

														<hr>
													{% endfor %}

												{% else %}
													<span style="color: red;">
														Aucune
													</span>
													&nbsp;&nbsp;
												{% endif %}

											</td>
											<td>
												{{link.show(path('collaborateur_show', {'id': collaborateur.id}))}}
												{{link.iconEdit(path('collaborateur_edit', {'id': collaborateur.id}))}}

											</td>
										</tr>
									{% else %}
										<tr>
											<td colspan="4">no records found</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>

					</div>
				</div>
				<div class="card-footer">
					{{link.back(path('projet_index'),'Liste des Projets')}}
					{{link.manageList(path('collaborateur_index', {'id': projet.id}),'gerer les collaborateurs')}}
				</div>
			</div>
		</div>
	</div>

{% endblock %}
