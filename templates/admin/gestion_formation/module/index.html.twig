{% extends 'admin/base.html.twig' %}

{% import "macros/table.html.twig" as table %}
{% import "macros/head.html.twig" as head %}
{% import "macros/foot.html.twig" as foot %}
{% import "macros/breadcrumb.html.twig" as utils %}
{% import "macros/alertes.html.twig" as alerte %}
{% import "macros/button.html.twig" as btn %}
{% import "macros/link.html.twig" as link %}
{% import "macros/dataTable.html.twig" as dataTable %}


{% block title %}Module
{% endblock %}

{% block head %}
	{{ dataTable.css() }}
{% endblock %}

{% block foot %}
	{{ dataTable.js() }}
{% endblock %}


{% block body %}

	{% for item in app.flashes('success') %}
		{{ alerte.alert(item,'success')}}

	{% endfor %}
	<div class="container-fluid">
		<div class="row mb-2">
			{{link.add(path('module_new'))}}
		</div>
	</div>
	<div class="row">
		<div class="col-lg-12 col-md-12 col-12">
			<div class="card card-outline card-lightblue">
				<div class="card-header">
					<h1>Tous Les Modules</h1>
				</div>
				<div class="card-body">
					<table class="table" id="table-2">
						<thead>
							<tr>
								<th>Id</th>
								<th>Designation</th>
								<th>Abreviation</th>
								<th>Description</th>
								<th>actions</th>
							</tr>
						</thead>
						<tbody>
							{% for module in modules %}
								<tr>
									<td>{{ module.id }}</td>
									<td>{{ module.designation }}</td>
									<td>{{ module.abreviation }}</td>
									<td>{{ module.description }}</td>
									<td>
										{{link.show(path('module_show', {'id': module.id}))}}
										{{link.iconEdit(path('module_edit', {'id': module.id}))}}
										<button type="submit" class="btn del_module"
                                                data-delete="{{module.id}}"
                                                data-path="{{path('module_delete',{'id':module.id})}}"
                                        >
											<i class="fas fa-trash-alt text-danger"></i>
										</button>
									</td>
								</tr>
							{% else %}
								<tr>
									<td colspan="5">no records found</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				<div class="card-footer"></div>
			</div>
		</div>
	</div>

{% endblock %}
{% block javascripts %}
	{{ dataTable.script('#table-1') }}
	{{ dataTable.script('#table-2') }}
	{{ dataTable.script('#table-3') }}

    <script>
        $(document).ready(function(){
            $(document).on('click','.del_module', function(e){
                e.preventDefault();
                let path = $(this).data('path');
                let id_del = $(this).data('delete');
                
                Swal.fire({
                    title: 'Etes Vous Sur ?',
                    text: "Attention, la suppression est irreversible !",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Oui, Supprimer !',
                    cancelButtonText: 'Annuler !'
                    }).then((result) => {
                    if (result.isConfirmed) {
                       $.ajax({
                        url:path,
                        method:'POST',
                        dataType:'JSON',
                        data:{
                            module:'katoula_yawou',
                            supr_module:id_del
                        },
                        success:function(data){
                                if(data == 'success'){
                                    Swal.fire(
                                        'Module Supprimé!',
                                        'Ce module a bien été supprimé.',
                                        'success'
                                    );
                                    location.reload();
                                }else{
                                    swalWithBootstrapButtons.fire(
                                    'Suppression Impossible',
                                    'Impossible de supprimer ce module, veuillez réessayer plus tard :)',
                                    'error'
                                    );
                                }
                            }
                       });
                    }
                 });
                
            });
        });
    </script>
{% endblock %}
