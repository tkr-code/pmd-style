{% extends 'admin/base.html.twig' %}

{% import "macros/table.html.twig" as table %}
{% import "macros/head.html.twig" as head %}
{% import "macros/foot.html.twig" as foot %}
{% import "macros/breadcrumb.html.twig" as utils %}
{% import "macros/alertes.html.twig" as alerte %}
{% import "macros/button.html.twig" as btn %}
{% import "macros/link.html.twig" as link %}
{% import "macros/badge.html.twig" as badge %}
{% import "macros/dataTable.html.twig" as dataTable %}


{% block head %}
	{{ dataTable.css() }}
{% endblock %}

{% block foot %}
	{{ dataTable.js() }}
{% endblock %}

{% block title %}Pointage
{% endblock %}

{% block body %}

	{% for item in app.flashes('success') %}
		{{alerte.alert(item,'success')}}
	{% endfor %}
	<div class="container-fluid">
		<div class="row mb-2">
			{{link.add(path('pointage_new',{'id':formation.id}))}}
		</div>
	</div>
	<div class="row mb-3">
		<div class="col-lg-12 col-md-12 col-xm-12">
			<div class="card card-outline card-primary">
				<div class="card-header">
					Les Pointages De la classe &nbsp;
					<b class="text-danger">{{classe.designation}}</b>
					&nbsp;concernant le module &nbsp;<b class="text-danger">{{module.designation}}</b>&nbsp;
					<small class="text-blue">abrégé</small>&nbsp;<b class="text-danger">{{module.abreviation}}</b>
					&nbsp; de
					<b class="text-danger">{{formation.volumeHoraire}}</b>
					H
																																								                    &nbsp; dans le Centre de Formation
					<b class="text-danger">{{classe.centreFormation.sigle}}</b>.
					<div class="row">
						<div class="col-md-6 col-lg-6 text-left">
							{% if heure_effectue == null %}
								<span>Vous avez effectué
									<b class="text-danger">0</b>
									H</span>
							{% else %}
								<span>Vous avez effectué
									<b class="text-danger">{{heure_effectue}}</b>
									H</span>
							{% endif %}

						</div>
						<div class="col-md-6 col-lg-6 text-right">


							{% if heure_restant > 0 %}
								<span>
									Il vous reste encore
									<b class="text-danger">{{heure_restant}}</b>
									H pour Terminer le module
								</span>
								{% elseif heure_restant == 0 %}
								<span>Vos Heures de Cour sont atteintes
									</span>
							{% else %}
								<span>Vos Heures de Cour sont atteintes, vous avez
									<b class="text-danger">{{ -1 * heure_restant}}</b>
									H</span>
								Supplementaire(s)
							{% endif %}

						</div>
					</div>
				</div>
				<div class="card-body">
					<table class="table" id="table-2">
						<thead>
							<tr>
								<th>Id</th>
								<th>NombreHeureDispense</th>
								<th>ContenuDispense</th>
								<th>DatePointage</th>
								<th>Heure Supplementaire</th>
								<th>actions</th>
							</tr>
						</thead>
						<tbody>
							{% for pointage in pointages %}
								<tr>
									<td>{{ pointage.id }}</td>
									<td>
										<b class="text-danger">{{ pointage.nombreHeureDispense }}</b>&nbsp;H</td>
									<td>{{ pointage.contenuDispense }}</td>
									<td>{{ pointage.datePointage ? pointage.datePointage|date('Y-m-d') : '' }}</td>
									<td>
										{% if pointage.esSupplementaire %}
											{{badge.complet('OUI')}}
										{% else %}
											{{badge.annuler('NON')}}
										{% endif %}
									</td>
									<td>
										{{link.show(path('pointage_show', {'id': pointage.id}))}}
										{{link.iconEdit(path('pointage_edit', {'id': pointage.id}))}}
										<button type="button" class="btn del_pointage" data-delete="{{pointage.id}}" data-path="{{path('pointage_delete',{'id':pointage.id})}}">
											<i class="fas fa-trash-alt text-danger"></i>
										</button>
									</td>
								</tr>
							{% else %}
								<tr>
									<td colspan="6">no records found</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
				<div class="card-footer">
					{{link.back(path('centre_formation_index'),'Tous Les Centres')}}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
{% block javascripts %}
	{{ dataTable.script('#table-1') }}
	{{ dataTable.script('#table-2') }}
	{{ dataTable.script('#table-3') }}

	<script>
		$(document).ready(function () {
$(document).on('click', '.del_pointage', function () {
let path = $(this).data('path');
let id_del = $(this).data('delete');

Swal.fire({
title: 'Etes Vous Sur ?',
text: "Attention la suppression est irreversible !",
icon: 'warning',
showCancelButton: true,
confirmButtonColor: '#3085d6',
cancelButtonColor: '#d33',
confirmButtonText: 'Oui, Supprimer !',
cancelButtonText: 'Annuler !'
}).then((result) => {
if (result.isConfirmed) {
$.ajax({
url: path,
method: 'POST',
dataType: 'JSON',
data: {
pointage_suppr: 'katoula',
id_pointage: id_del
},
success: function (data) {
if (data == 'success') {
Swal.fire('Supprimé !', 'Votre Pointage a été supprimé avec succès.', 'success');
location.reload();
} else {
swalWithBootstrapButtons.fire('Pointage Supprimé', 'Suppression Impossible, veuillez rééssayer plus tard :)', 'error');
}
}
});

}
})

});
});
	</script>
{% endblock %}
